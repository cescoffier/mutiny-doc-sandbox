<!doctype html>
<html lang="en">

<head>
    <title>Collecting items from Multi</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Learn how to collect items from a Multi">

    <link rel="canonical" href="/getting-started/collecting-items.html">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.1/styles/default.min.css">
    <link rel="shortcut icon" type="image/png" href="/mutiny-doc-sandbox/assets/images/favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="/mutiny-doc-sandbox/assets/css/main.css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/630fce6bad.js" crossorigin="anonymous"></script>
</head>

<body>

    <div class="container-fluid global-container ">
        <main>
            <header class="header">
    <div class="container header-container">
        <div class="row">
            <div class="col-5">
                <a class="brand" href="/mutiny-doc-sandbox/index.html"><strong>Mutiny!</strong></a>
            </div>
            <div class="col-7">
                <nav id="nav" class="nav nav-masthead justify-content-right">
                    <a class="nav-link active" href="/mutiny-doc-sandbox/index.html">Home</a>
                    <a class="nav-link" href="/mutiny-doc-sandbox/getting-started/getting-started">Getting Started</a>
                    <a class="nav-link" href="/mutiny-doc-sandbox/pages/philosophy.html">Concepts</a>
                    <a class="nav-link" href="#">Documentation</a>
                    <a href="https://github.com/smallrye/smallrye-mutiny" target="_blank" title="Github"><i class="fab fa-github"></i></a>
                    <a href="https://stackoverflow.com/questions/tagged/mutiny" target="_blank" title="Stack Overflow"><i class="fab fa-stack-overflow"></i></a>
                </nav>
            </div>
        </div>
    </div>
</header>
            <div class="content">
                <section class="hero gs">
    <div class="hero-main container">
        <div class="row">
            <div class="hero-left col-12">
                <div class="hero-slogan">
                    <h1 class="hero-name">Collecting items from Multi</h1>
                </div>
                <div class="hero-desc">
                    Learn how to collect items from a Multi
                </div>
                <div class="hero-buttons">
                    
                    <a href="/mutiny-doc-sandbox/getting-started/retry" class="btn btn-rounded button button-dark button-rounded">
                        <i class="far fa-arrow-alt-circle-left"></i>&nbsp;Retrying on failure</a>
                     
                </div>
            </div>
        </div>
    </div>
</section>

<div class="container page-content">
    <div class="row">
        <div class="col-md-8 content">
            <div class="sect1">
<h2 id="collecting-items"><a class="anchor" href="#collecting-items"></a>Collecting items</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are cases where you want to accumulate the items from a <code>Multi</code> and produce a <code>Uni</code> with the collected result.
The <code>Uni</code> fires its item when the <code>Multi</code> completes.
Mutiny provides multiple operators to deal with that scenario.
For example, you can store the items in a list, emit the list on completion, or use a Java <code>Collector</code> to customize the aggregation.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Don&#8217;t collect items from infinite streams.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="collecting-items-into-a-list"><a class="anchor" href="#collecting-items-into-a-list"></a>Collecting items into a list</h3>
<div class="paragraph">
<p>One of the most common approaches to collect items is to store them into a list.
It returns a <code>Uni&lt;List&lt;T&gt;&gt;.</code>
It emits the final list when the <code>Multi</code> completes.</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="/mutiny-doc-sandbox/assets/images/collect-as-list.png" alt="Collecting items into a list">
</div>
</div>
<div class="paragraph">
<p>How to achieve this with Mutiny?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Multi&lt;String&gt; multi = ...;
Uni&lt;List&lt;String&gt;&gt; uni = multi.collectItems().asList();</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s important to note that the returned type is a <code>Uni.</code>
It emits the list when the multi completes.</p>
</div>
</div>
<div class="sect2">
<h3 id="collecting-items-into-a-map"><a class="anchor" href="#collecting-items-into-a-map"></a>Collecting items into a map</h3>
<div class="paragraph">
<p>You can also collect the items into a <code>Map.</code>
In this case, you need to provide a function to compute the key for each item:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Multi&lt;String&gt; multi = ...;
Uni&lt;Map&lt;String, String&gt;&gt; uni =
  multi.collectItems()
    .asMap(item -&gt; getKeyForItem(item))</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the key mapper function returns the same key for multiple items, the last one with that key is stored in the produced <code>Map.</code>
You can collect items in a <em>multimap</em> to handle items with the same keys.</p>
</div>
</div>
<div class="sect2">
<h3 id="collecting-items-into-a-multimap"><a class="anchor" href="#collecting-items-into-a-multimap"></a>Collecting items into a multimap</h3>
<div class="paragraph">
<p>A multimap is a <code>Map&lt;K, List&lt;T&gt;&gt;.</code>
In the case of a conflicting key, it stores all the items in a list associated with that key.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Multi&lt;String&gt; multi = ...;
Uni&lt;Map&lt;String, String&gt;&gt; uni =
  multi.collectItems()
    .asMultiMap(item -&gt; getKeyForItem(item));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-a-custom-accumulator"><a class="anchor" href="#using-a-custom-accumulator"></a>Using a custom accumulator</h3>
<div class="paragraph">
<p>You can also use a custom <em>accumulator</em> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Multi&lt;String&gt; multi = ...;
Uni&lt;MyCollection&gt; uni = multi.collectItems()
  .in(MyCollection::new, (col, item) -&gt; col.add(item));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>in</code> method receives two arguments:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>a supplier providing the new instance of your collection/container</p>
</li>
<li>
<p>the accumulator function</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can also use a Java <code>Collector</code>.
For example, in the next example, count the number of items, and produce the final count as item:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Uni&lt;Long&gt; count = multi.collectItems()
  .with(Collectors.counting());</code></pre>
</div>
</div>
</div>
</div>
</div>
        </div>
        <div class="col-md-4 col-md-offset-1 toc-container">
            <nav class="page-toc toc nav flex-column" id="toc">
                <ul class="sectlevel1">
<li><a href="#collecting-items">Collecting items</a>
<ul class="sectlevel2">
<li><a href="#collecting-items-into-a-list">Collecting items into a list</a></li>
<li><a href="#collecting-items-into-a-map">Collecting items into a map</a></li>
<li><a href="#collecting-items-into-a-multimap">Collecting items into a multimap</a></li>
<li><a href="#using-a-custom-accumulator">Using a custom accumulator</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>



<div class="footer-buttons gs ">
    <div class="container ">
        <div class="row ">
            <div class="col-12 ">
                
                <a href="/mutiny-doc-sandbox/getting-started/retry " class="previous ">
                    <i class="fas fa-arrow-left "></i>&nbsp;Retrying on failure</a>
                 
            </div>
        </div>

    </div>
            </div>

            <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-6 sep-right">
                <p>
                    SmallRye Mutiny is an open source project. All the code from this project is available under the Apache Software License 2.0.
                </p>
                <p>
                    This website was built with Jekyll, is hosted on Github Pages and is completely open source. If you want to make it better, fork the website and show us what youâ€™ve got.
                </p>
            </div>
            <div class="col-lg-6">
                <p>
                     Site last generated: Nov 4, 2020
                </p>
            </div>
        </div>
    </div>
    <!-- Javascript-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.1/highlight.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/cferdinandi/gumshoe@4/dist/gumshoe.polyfills.min.js"></script>
    <script src="/mutiny-doc-sandbox/assets/js/hl.js" type="text/javascript"></script>
    <script src="/mutiny-doc-sandbox/assets/js/scrollspy.js" type="text/javascript"></script>
</footer>
        </main>
    </div>
</body>

</html>