<!doctype html>
<html lang="en">

<head>
    <title>Transforming items into Uni and Multi</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Learn how to transform received item into asynchronous streams">

    <link rel="canonical" href="/getting-started/transforming-items-async.html">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.1/styles/default.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/components/icon.min.css" integrity="sha512-8Tb+T7SKUFQWOPIQCaLDWWe1K/SY8hvHl7brOH8Nz5z1VT8fnf8B+9neoUzmFY3OzkWMMs3OjrwZALgB1oXFBg==" crossorigin="anonymous" />
    <link rel="shortcut icon" type="image/png" href="/mutiny-doc-sandbox/assets/images/favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="/mutiny-doc-sandbox/assets/css/main.css" />
<!--    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">-->
    <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/font-awesome-line-awesome/css/all.min.css">
    <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
<!--    <script src="https://kit.fontawesome.com/630fce6bad.js" crossorigin="anonymous"></script>-->
</head>

<body>

    <div class="container-fluid global-container ">
        <main>
            <header class="header">
    <div class="container header-container">
        <div class="row">
            <div class="col-5">
                <a class="brand" href="/mutiny-doc-sandbox/index.html"><strong>Mutiny!</strong></a>
            </div>
            <div class="col-7">
                <nav id="nav" class="nav nav-masthead justify-content-right">
                    <a class="nav-link active" href="/mutiny-doc-sandbox/index.html">Home</a>
                    <a class="nav-link" href="/mutiny-doc-sandbox/getting-started/getting-started">Getting Started</a>
                    <a class="nav-link" href="/mutiny-doc-sandbox/pages/philosophy.html">Concepts</a>
                    <a class="nav-link" href="#">Documentation</a>
                    <a href="https://github.com/smallrye/smallrye-mutiny" target="_blank" title="Github"><i class="lab la-github la-2x"></i></a>
                    <a href="https://stackoverflow.com/questions/tagged/mutiny" target="_blank" title="Stack Overflow"><i class="lab la-stack-overflow la-2x"></i></a>
                </nav>
            </div>
        </div>
    </div>
</header>
            <div class="content">
                <section class="hero gs">
    <div class="hero-main container">
        <div class="row">
            <div class="hero-left col-12">
                <div class="hero-slogan">
                    <h1 class="hero-name">Transforming items into Uni and Multi</h1>
                </div>
                <div class="hero-desc">
                    Learn how to transform received item into asynchronous streams
                </div>
                <div class="hero-buttons">
                    
                    <a href="/mutiny-doc-sandbox/getting-started/transforming-items" class="btn btn-rounded button button-dark button-rounded">
                        <i class="las la-arrow-left left"></i>&nbsp;Transforming items</a>
                     
                    <a href="/mutiny-doc-sandbox/getting-started/merge-concat" class="btn btn-rounded button button-dark button-rounded">
                Merging and Concatenating streams&nbsp;<i class="las la-arrow-right"></i></a> 
                </div>
            </div>
        </div>
    </div>
</section>

<div class="container page-content">
    <div class="row">
        <div class="col-md-8 content">
            <div class="sect1">
<h2 id="transforming-items-into-streams"><a class="anchor" href="#transforming-items-into-streams"></a>Transforming items into streams</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previous examples illustrate how to transform each item from a stream into another item.
Yet, there are cases where we need to go beyond this, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Transforming an item into a <code>Uni</code> - any asynchronous processing such as calling a remote service, interacting with a database&#8230;&#8203;</p>
</li>
<li>
<p>Transforming an item into a <code>Multi</code> - producing a multi-items stream based on the incoming item, filtering out items (by returning an empty stream)&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Having the possibility to transform an item into a stream gives us many opportunities.
To implement such transformations, use <code>onItem().transformToUni(Funcction&lt;T, Uni&lt;O&gt;&gt;</code> and <code>onItem().transformToMulti(Function&lt;T, Multi&lt;O&gt;&gt;)</code></p>
</div>
<div class="imageblock center">
<div class="content">
<img src="/mutiny-doc-sandbox/assets/images/transform-to-uni.png" alt="Transforming items into Uni">
</div>
</div>
<div class="sect2">
<h3 id="uni-transforming-an-item-into-a-uni"><a class="anchor" href="#uni-transforming-an-item-into-a-uni"></a>Uni - Transforming an item into a Uni</h3>
<div class="paragraph">
<p>Imagine you have a <code>Uni&lt;String&gt;,</code> and you want to call a remote service.
Calling a remote service is an asynchronous action represented by a <code>Uni.</code>
Something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Uni&lt;String&gt; invokeRemoteGreetingService(String name);</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, to call this service, you need to transform the item received from the first <code>Uni</code> into the <code>Uni</code> returned by the service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Uni&lt;String&gt; result = uni
    .onItem().transformToUni(name -&gt; invokeRemoteGreetingService(name));</code></pre>
</div>
</div>
<div class="paragraph">
<p>This snippet <em>chains</em> the first <code>Uni</code> with another one.
The returned <code>Uni</code> (<code>result</code>) emits the result from the remote service or a failure if anything wrong happened:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Uni&lt;String&gt; uni = Uni.createFrom().item("Cameron");
Uni&lt;String&gt; result = uni
    .onItem().transformToUni(name -&gt; invokeRemoteGreetingService(name))
    .subscribe().with(
        item -&gt; System.out.println(item) // Print "Hello Cameron"
    );</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="uni-transforming-an-item-into-a-multi"><a class="anchor" href="#uni-transforming-an-item-into-a-multi"></a>Uni - Transforming an item into a Multi</h3>
<div class="paragraph">
<p>The previous section produces a single item.
You may want to transform the received item into a stream.
For this, we need to transform the item into a <code>Multi</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Uni&lt;String&gt; result = uni
    .onItem().transformToMulti(item -&gt; Multi.createFrom().items(item, item));</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code creates a stream of two elements, duplicating the received item.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Uni&lt;String&gt; uni = Uni.createFrom().item("Cameron");
Uni&lt;String&gt; result = uni
    .onItem().transformToMulti(item -&gt; Multi.createFrom().items(item, item))
    .subscribe().with(
        item -&gt; System.out.println(item) // Called twice
    );</code></pre>
</div>
</div>
<div class="imageblock center">
<div class="content">
<img src="/mutiny-doc-sandbox/assets/images/uni-transform-to-multi.png" alt="Transforming item into a Multi">
</div>
</div>
<div class="paragraph">
<p>The produced <code>Multis</code> can be more complicated and emit items asynchronously.</p>
</div>
</div>
<div class="sect2">
<h3 id="transforming-items-from-multi-the-merge-dilemma"><a class="anchor" href="#transforming-items-from-multi-the-merge-dilemma"></a>Transforming items from Multi - the <em>merge</em> dilemma</h3>
<div class="paragraph">
<p>When transforming items emitted by an upstream <code>Multi,</code> we need to answer the following question:
how are we going to <em>merge</em> the produced items back?</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take an example.
Imagine a <code>Multi</code> emitting the 'Cameron' and 'Donna' items in this order.
You want to call the <code>invokeRemoteGreetingService</code> from above.
So, it calls <code>invokeRemoteGreetingService("Cameron")</code> and <code>invokeRemoteGreetingService("Donna")</code>.
The service does not have a constant response time (because of network latency or the load), which means that responses can be interleaved.
Indeed, you may receive "Hello Donna" before "Hello Cameron."
Now, how do you want to handle this case?
Do you need to preserve the order and ensure that the downstream subscriber will always get "Hello Cameron" first, or do you accept interleaved responses?</p>
</div>
<div class="paragraph">
<p>When transforming items from <code>Multi</code> into streams, you need to decide in which order the items emitted by the produced stream are going to be received by the downstream subscriber.
Mutiny offers two possibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>merge</em> - it does not preserve the order and emits the items from the produced streams as they come,</p>
</li>
<li>
<p><em>concatenate</em> - it maintains and concatenates the streams produced for each item.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="multi-transforming-an-item-into-a-uni"><a class="anchor" href="#multi-transforming-an-item-into-a-uni"></a>Multi - Transforming an item into a Uni</h3>
<div class="paragraph">
<p>To implement the scenario from the last section, you will use <code>onItem().transformToUniAndMerge</code> or <code>onItem().transformToUniAndConcatenate()</code> depending on your ordering choice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Multi&lt;String&gt; m = multi
    .onItem().transformToUniAndMerge(name -&gt; invokeRemoteGreetingService(name));

Multi&lt;String&gt; m = multi
    .onItem().transformToUniAndConcatenate(name -&gt; invokeRemoteGreetingService(name));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multi-transforming-an-item-into-a-multi"><a class="anchor" href="#multi-transforming-an-item-into-a-multi"></a>Multi - Transforming an item into a Multi</h3>
<div class="paragraph">
<p><code>onItem().transformToMultiAndMerge</code> and <code>onItem().transformToMultiAndConcatenate</code> allow transforming incoming items into <code>Multi</code>.
The produced <code>Multis</code> are either <em>merged</em> or <em>concatenated</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Multi&lt;String&gt; m = multi
    .onItem().transformToMultiAndMerge(item -&gt; functionProducingAMulti(item));

Multi&lt;String&gt; m = multi
    .onItem().transformToUniAndConcatenate(item -&gt; functionProducingAMulti(item));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next page gives more details about merge and concatenation.</p>
</div>
</div>
</div>
</div>
        </div>
        <div class="col-md-4 col-md-offset-1 toc-container">
            <nav class="page-toc toc nav flex-column" id="toc">
                <ul class="sectlevel1">
<li><a href="#transforming-items-into-streams">Transforming items into streams</a>
<ul class="sectlevel2">
<li><a href="#uni-transforming-an-item-into-a-uni">Uni - Transforming an item into a Uni</a></li>
<li><a href="#uni-transforming-an-item-into-a-multi">Uni - Transforming an item into a Multi</a></li>
<li><a href="#transforming-items-from-multi-the-merge-dilemma">Transforming items from Multi - the <em>merge</em> dilemma</a></li>
<li><a href="#multi-transforming-an-item-into-a-uni">Multi - Transforming an item into a Uni</a></li>
<li><a href="#multi-transforming-an-item-into-a-multi">Multi - Transforming an item into a Multi</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>



<div class="footer-buttons gs ">
    <div class="container ">
        <div class="row ">
            <div class="col-12 ">
                
                <a href="/mutiny-doc-sandbox/getting-started/transforming-items " class="previous ">
                    <i class="fas fa-arrow-left "></i>&nbsp;Transforming items</a>
                 
                <a href="/mutiny-doc-sandbox/getting-started/merge-concat " class="next ">
    Merging and Concatenating streams&nbsp;<i class="fas fa-arrow-right "></i></a> 
            </div>
        </div>

    </div>
            </div>

            <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-6 sep-right">
                <p>
                    SmallRye Mutiny is an open source project. All the code from this project is available under the Apache Software License 2.0.
                </p>
                <p>
                    This website was built with Jekyll, is hosted on Github Pages and is completely open source. If you want to make it better, fork the website and show us what youâ€™ve got.
                </p>
            </div>
            <div class="col-lg-6">
                <p>
                     Site last generated: Nov 23, 2020
                </p>
            </div>
        </div>
    </div>
    <!-- Javascript-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.1/highlight.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/cferdinandi/gumshoe@4/dist/gumshoe.polyfills.min.js"></script>
    <script src="/mutiny-doc-sandbox/assets/js/hl.js" type="text/javascript"></script>
    <script src="/mutiny-doc-sandbox/assets/js/scrollspy.js" type="text/javascript"></script>
</footer>
        </main>
    </div>
</body>

</html>